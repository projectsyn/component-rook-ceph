parameters:
  kapitan:
    dependencies:
      - type: helm
        source: https://charts.rook.io/release
        chart_name: rook-ceph
        version: ${rook_ceph:charts:rook-ceph}
        output_path: dependencies/rook-ceph/helmcharts/rook-ceph/${rook_ceph:charts:rook-ceph}
      - type: https
        source: https://raw.githubusercontent.com/rook/rook/${rook_ceph:images:rook:tag}/deploy/examples/csi/rbd/storageclass.yaml
        output_path: dependencies/rook-ceph/manifests/${rook_ceph:images:rook:tag}/rbd-storageclass.yaml
      - type: https
        source: https://raw.githubusercontent.com/rook/rook/${rook_ceph:images:rook:tag}/deploy/examples/csi/rbd/snapshotclass.yaml
        output_path: dependencies/rook-ceph/manifests/${rook_ceph:images:rook:tag}/rbd-snapshotclass.yaml
      - type: https
        source: https://raw.githubusercontent.com/rook/rook/${rook_ceph:images:rook:tag}/deploy/examples/csi/cephfs/storageclass.yaml
        output_path: dependencies/rook-ceph/manifests/${rook_ceph:images:rook:tag}/cephfs-storageclass.yaml
      - type: https
        source: https://raw.githubusercontent.com/rook/rook/${rook_ceph:images:rook:tag}/deploy/examples/csi/cephfs/snapshotclass.yaml
        output_path: dependencies/rook-ceph/manifests/${rook_ceph:images:rook:tag}/cephfs-snapshotclass.yaml
      - type: https
        source: https://raw.githubusercontent.com/rook/rook/${rook_ceph:images:rook:tag}/deploy/examples/monitoring/csi-metrics-service-monitor.yaml
        output_path: dependencies/rook-ceph/manifests/${rook_ceph:images:rook:tag}/csi-metrics-service-monitor.yaml
      - type: https
        # NOTE(sg): prometheus-ceph-v16-rules.yaml is a symlink to #
        # prometheus-ceph-v14-rules.yaml, so we directly fetch the v14 file,
        # as fetching symlinks via raw.githubusercontent doesn't work
        # properly.
        source: https://raw.githubusercontent.com/rook/rook/${rook_ceph:images:rook:tag}/deploy/examples/monitoring/prometheus-ceph-v14-rules.yaml
        output_path: dependencies/rook-ceph/manifests/${rook_ceph:images:rook:tag}/prometheus-ceph-rules.yaml
    compile:
      - input_paths:
          - rook-ceph/component/app.jsonnet
        input_type: jsonnet
        output_path: apps/
      - input_paths:
          - rook-ceph/helmcharts/rook-ceph/${rook_ceph:charts:rook-ceph}
        input_type: helm
        output_type: yaml
        output_path: rook-ceph/01_rook_ceph_helmchart
        helm_values: ${rook_ceph:operator_helm_values}
        helm_params:
          name: syn-rook-ceph
          namespace: ${rook_ceph:namespace}
      - input_paths:
          - rook-ceph/component/main.jsonnet
        input_type: jsonnet
        output_path: rook-ceph/
  commodore:
    postprocess:
      filters:
        - type: jsonnet
          path: rook-ceph/01_rook_ceph_helmchart/rook-ceph/templates/
          filter: postprocess/patch_operator_deployment.jsonnet
